---
title: "TSA Tutorial"
author: "Sushanth S"
date: "2025-09-19"
output:
  pdf_document:
    latex_engine: xelatex
    extra_dependencies:
    - fancyhdr
    - graphicx
  word_document: default
  html_document:
    theme: cerulean
    highlight: tango
    number_lines: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,number.lines = TRUE)
knitr::opts_chunk$set(comment = "")
```

# 1. Analysis of lynx Dataset

The lynx dataset contains annual lynx trappings from 1821 to 1934, known for its distinct cyclical pattern.

```{r}

# Load libraries once for the entire document
library(forecast)
library(tseries)
library(imputeTS)

# Exploratory Data Analysis
# Check if the dataset is a time series object
data("lynx")
str(lynx)
print("Dataset: lynx - Annual lynx trappings (1821-1934), time series confirmed.")

# Plot the time series
plot(lynx, main = "Lynx Trapping Time Series", ylab = "Number of Lynx")
summary(lynx)

# Decomposition using STL for cyclical patterns
lynx_ts <- ts(lynx, frequency = 10) # 10 year cycle
decomp_lynx <- stl(lynx_ts, s.window = "periodic")
plot(decomp_lynx, main = "STL Decomposition: Lynx")

# Data Preprocessing
# Check for missing values (none)
sum(is.na(lynx))

# Apply log transformation to stabilize variance
log_ts_lynx <- log(lynx)
plot(log_ts_lynx, main = "Log-Transformed Lynx Series")

# Apply first differencing to achieve stationarity
diff_ts_lynx <- diff(log_ts_lynx, differences = 1)
plot(diff_ts_lynx, main = "First Difference of Log-Transformed Lynx")

# Stationarity Testing
# ADF Test for the original series
adf_original_lynx <- adf.test(lynx)
print(adf_original_lynx)

# KPSS Test for the original series
kpss_original_lynx <- kpss.test(lynx)
print(kpss_original_lynx)

# ADF Test for the differenced series
adf_diff_lynx <- adf.test(diff_ts_lynx)
print(adf_diff_lynx)

# KPSS Test for the differenced series
kpss_diff_lynx <- kpss.test(diff_ts_lynx)
print(kpss_diff_lynx)

# Modelling and Forecasting
# Fit Holt-Winters model on the original series
# Use a multiplicative model due to varying amplitude of the cycles
hw_model_lynx <- HoltWinters(lynx_ts, seasonal = "multiplicative")
plot(hw_model_lynx, main = "Holt-Winters Fit: Lynx")
summary(hw_model_lynx)

# Fit AR(1) and MA(1) models on the differenced series
ar_model_lynx <- arima(diff_ts_lynx, order = c(1, 0, 0))
summary(ar_model_lynx)

ma_model_lynx <- arima(diff_ts_lynx, order = c(0, 0, 1))
summary(ma_model_lynx)

# ACF/PACF plots to check for remaining patterns
acf(diff_ts_lynx, main = "ACF: Differenced Lynx")
pacf(diff_ts_lynx, main = "PACF: Differenced Lynx")

# Final Forecast
# Forecast using Holt-Winters
hw_forecast_lynx <- forecast(hw_model_lynx, h = 10)
plot(hw_forecast_lynx, main = "Holt-Winters Forecast: Lynx")
print(hw_forecast_lynx)
```

# 2. Analysis of sunspots Dataset

The sunspots dataset contains monthly sunspot counts from 1749 to 1983, a classic example of cyclical data with a period of approximately 11 years.

```{r}
# Exploratory Data Analysis
data("sunspots")
str(sunspots)
print("Dataset: sunspots - Monthly sunspots (1749-1983), time series confirmed.")
plot(sunspots, main = "Monthly Sunspots Time Series", ylab = "Sunspot Count")
summary(sunspots)

# Decomposition (Solar cycle is ~11 years, which is 132 months)
sunspots_ts_adj <- ts(sunspots, frequency = 132)
decomp_sunspots <- decompose(sunspots_ts_adj, type = "additive")
plot(decomp_sunspots)

# Data Preprocessing
# Check for missing values (none)
sum(is.na(sunspots))

# Log transformation to handle zeroes and stabilize variance
log_ts_sunspots <- log(sunspots + 1) # Add 1 to avoid log(0)
plot(log_ts_sunspots, main = "Log-Transformed Sunspots")

# Apply first differencing
diff_ts_sunspots <- diff(log_ts_sunspots, differences = 1)
plot(diff_ts_sunspots, main = "First Difference of Log-Transformed Sunspots")

# Stationarity Testing
# Original series tests
adf_original_sunspots <- adf.test(sunspots)
print(adf_original_sunspots)
kpss_original_sunspots <- kpss.test(sunspots)
print(kpss_original_sunspots)

# Differenced series tests
adf_diff_sunspots <- adf.test(diff_ts_sunspots)
print(adf_diff_sunspots)
kpss_diff_sunspots <- kpss.test(diff_ts_sunspots)
print(kpss_diff_sunspots)

# Modelling and Forecasting
# Fit Holt-Winters model
hw_model_sunspots <- HoltWinters(sunspots_ts_adj, seasonal = "additive")
plot(hw_model_sunspots, main = "Holt-Winters Fit: Sunspots")
summary(hw_model_sunspots)

# Fit AR(1) and MA(1) models on the differenced series
ar_model_sunspots <- arima(diff_ts_sunspots, order = c(1, 0, 0))
summary(ar_model_sunspots)

ma_model_sunspots <- arima(diff_ts_sunspots, order = c(0, 0, 1))
summary(ma_model_sunspots)

# ACF/PACF plots
acf(diff_ts_sunspots, main = "ACF: Differenced Sunspots")
pacf(diff_ts_sunspots, main = "PACF: Differenced Sunspots")

# Final Forecast
# Forecast using Holt-Winters
hw_forecast_sunspots <- forecast(hw_model_sunspots, h = 132) # 11 years
plot(hw_forecast_sunspots, main = "Holt-Winters Forecast: Sunspots")
print(hw_forecast_sunspots)
```

# 3. Analysis of USAccDeaths Dataset

The USAccDeaths dataset contains monthly totals of accidental deaths in the USA from 1973 to 1978. It exhibits a clear seasonal pattern.

```{r}
# Exploratory Data Analysisdata("USAccDeaths")
str(USAccDeaths)
print("Dataset: USAccDeaths - Monthly accidental deaths (1973-1978), time series confirmed.")
plot(USAccDeaths, main = "US Accidental Deaths Time Series", ylab = "Deaths")
summary(USAccDeaths)

# Decomposition (monthly data has a frequency of 12)
decomp_usac <- decompose(USAccDeaths, type = "additive")
plot(decomp_usac)

# Data Preprocessing
# Check for missing values (none)
sum(is.na(USAccDeaths))

# Apply log transformation
log_ts_usac <- log(USAccDeaths)
plot(log_ts_usac, main = "Log-Transformed USAccDeaths")

# Apply first differencing
diff_ts_usac <- diff(log_ts_usac, differences = 1)
plot(diff_ts_usac, main = "First Difference of Log-Transformed USAccDeaths")

# Stationarity Testing        
# Original series tests
adf_original_usac <- adf.test(USAccDeaths)
print(adf_original_usac)
kpss_original_usac <- kpss.test(USAccDeaths)
print(kpss_original_usac)

# Differenced series tests
adf_diff_usac <- adf.test(diff_ts_usac)
print(adf_diff_usac)
kpss_diff_usac <- kpss.test(diff_ts_usac)
print(kpss_diff_usac)

# Modelling and Forecasting
# Fit Holt-Winters model
hw_model_usac <- HoltWinters(USAccDeaths, seasonal = "additive")
plot(hw_model_usac, main = "Holt-Winters Fit: USAccDeaths")
summary(hw_model_usac)

# Fit AR(1) and MA(1) models on the differenced series
ar_model_usac <- arima(diff_ts_usac, order = c(1, 0, 0))
summary(ar_model_usac)

ma_model_usac <- arima(diff_ts_usac, order = c(0, 0, 1))
summary(ma_model_usac)

# ACF/PACF plots
acf(diff_ts_usac, main = "ACF: Differenced USAccDeaths")
pacf(diff_ts_usac, main = "PACF: Differenced USAccDeaths")

# Final Forecast
# Forecast using Holt-Winters
hw_forecast_usac <- forecast(hw_model_usac, h = 12) # 1 year
plot(hw_forecast_usac, main = "Holt-Winters Forecast: USAccDeaths")
print(hw_forecast_usac)
```
